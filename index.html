<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>A-Frame で超簡単 AR</title>
    <script>
      window.onload = function onLoad() {
        param = GetQueryString();
        target = document.getElementById("param");
        target.src =
          "https://nurie.s3-ap-northeast-1.amazonaws.com/ogpimg/" + param["q"];
      };

      function GetQueryString() {
        if (1 < document.location.search.length) {
          // 最初の1文字 (?記号) を除いた文字列を取得する
          var query = document.location.search.substring(1);

          // クエリの区切り記号 (&) で文字列を配列に分割する
          var parameters = query.split("&");

          var result = new Object();
          for (var i = 0; i < parameters.length; i++) {
            // パラメータ名とパラメータ値に分割する
            var element = parameters[i].split("=");

            var paramName = decodeURIComponent(element[0]);
            var paramValue = decodeURIComponent(element[1]);

            // パラメータ名をキーとして連想配列に追加する
            result[paramName] = decodeURIComponent(paramValue);
          }
          return result;
        }
        return null;
      }
    </script>
  </head>
  <body style="margin: 0px; overflow: hidden">
    <style>
      .arjs-loader {
        height: 100%;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .arjs-loader div {
        text-align: center;
        font-size: 1.25em;
        color: white;
      }
    </style>
    <!-- A-Frame ライブラリの読み込み -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <!-- AR.js ライブラリの読み込み -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <div class="arjs-loader">
      <div>Loading, please wait...</div>
    </div>
    <a-scene
      vr-mode-ui="enabled: false;"
      renderer="logarithmicDepthBuffer: true;"
      embedded
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    >
      <!-- use rawgithack to retrieve the correct url for nft marker (see 'trex' below) -->
      <a-nft
        type="nft"
        url="https://arjs-cors-proxy.herokuapp.com/https://raw.githack.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/trex-image/trex"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
      >
        <a-assets>
          <img id="params" src="" />
        </a-assets>
        <a-entity
          position="300 0 -400"
          scale="5 5 5"
          animation="property: position; to: 300 600 -400; loop: true; dur: 3000;"
        >
          <a-image width="54" height="30" src="#params"></a-image>
        </a-entity>
      </a-nft>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
